<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Favorite Movies</title>
  <style type="text/css">
  </style>
</head>

<body>
  <div class="container">
    <h1>Weather Search</h1>

    <!-- Rendered Buttons will get Dumped Here  -->

    <form id="search-form">
      <label for="city-input">Search a city</label>
      <input type="text" id="city-input"><br>

      <!-- Button triggers new movie to be added -->
      <input id="search-city" type="submit" value="Search">
    </form>

    <!-- Movies will Get Dumped Here -->
    <div id="weather-view">

    </div>
  </div>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="http://www.dukelearntoprogram.com/course1/common/js/image/SimpleImage.js"></script>
  <script type="text/javascript">



    $("#search-city").on("click", function(event){
      event.preventDefault();
      //on click of button will automatically search for meals with chicken breast as the main ingredient
      var queryURL = "https://www.themealdb.com/api/json/v2/9973533/filter.php?i=chicken_breast"
      $.ajax({
        url: queryURL,
        method: "GET"
      }).then(function(response){
        //stores the chicken breast meals response in a variable called results
        var results = response.meals
        //for each meal go in and find the mealID
        for(var i = 0; i < results.length; i++){
          var mealID = results[i].idMeal;
          //search the mealID of each chicken breast meal response
          var mealURL = "https://www.themealdb.com/api/json/v2/9973533/lookup.php?i=" + mealID;
          $.ajax({
            url: mealURL,
            method: "GET"
          }).then(function(data){
            console.log(data);
            //for each meal ID get the necessary information
            var mealResults = data.meals;
            for(var j = 0; j < mealResults.length; j++){
              //store ingredients into an array - not all ingredients will have something listed
              var ingredients = [mealResults[j].strIngredient1, mealResults[j].strIngredient2, mealResults[j].strIngredient3, mealResults[j].strIngredient4, mealResults[j].strIngredient5, mealResults[j].strIngredient6, mealResults[j].strIngredient7, mealResults[j].strIngredient8, mealResults[j].strIngredient9, mealResults[j].strIngredient10, mealResults[j].strIngredient11, mealResults[j].strIngredient12, mealResults[j].strIngredient13, mealResults[j].strIngredient14, mealResults[j].strIngredient15, mealResults[j].strIngredient16, mealResults[j].strIngredient17, mealResults[j].strIngredient18, mealResults[j].strIngredient19, mealResults[j].strIngredient20, ]
              //store measurements into an array - not all measurements will have something listed
              var measurements = [mealResults[j].strMeasure1, mealResults[j].strMeasure2, mealResults[j].strMeasure3, mealResults[j].strMeasure4, mealResults[j].strMeasure5, mealResults[j].strMeasure6, mealResults[j].strMeasure7, mealResults[j].strMeasure8, mealResults[j].strMeasure9, mealResults[j].strMeasure10, mealResults[j].strMeasure11, mealResults[j].strMeasure12, mealResults[j].strMeasure13, mealResults[j].strMeasure14, mealResults[j].strMeasure15, mealResults[j].strMeasure16, mealResults[j].strMeasure17, mealResults[j].strMeasure18, mealResults[j].strMeasure19, mealResults[j].strMeasure20, ]
             //store instructions into an array
              var instructions = mealResults[j].strInstructions;
              //store images into an array
              var image = mealResults[j].strMealThumb;
              //creates a new paragraph to store everything into at the end
              var newPar= $("<p>");
              //creates a new image tag to display each image
              var displayImage = $("<img>");
              //gets the index of the ingredient index of the first ingredient with just a space as it's content
              var firstSpaceIng = ingredients.indexOf(" ");
              //uses the firstSpaceIng index to slice off the portion of the array that only has actual ingredients listed and stores them in a new array
              var newIngredientsArray = ingredients.slice(0, firstSpaceIng);
              //gets the index of the measurement index of the first measurement with a just a space as it's content
              var firstSpaceMeas = measurements.indexOf(" ");
              //uses the firstSpaceMeas index to slice off the portion of the array that only has actual measuerments listed and stores them in a a new array
              var newMeasurementsArray = measurements.slice(0, firstSpaceMeas);
              
              //this array combines both the measurements array and the ingredients array based on their indexes
              var newArray = newMeasurementsArray.map((e, i) => e + " " + newIngredientsArray[i]);
              //this loops through the new array and stores each combintation in their own div which is appended to the paragraph
              for(var x=0; x < newArray.length; x++){
                var newDiv = $("<div>");
                newDiv.text(newArray[x]);
                newPar.append(newDiv);
              }
              displayImage.attr("src", image);
              displayImage.addClass("image");
              
              newPar.append(instructions, displayImage);
              $("#weather-view").append(newPar);
            }
          });
        };
      });
    });

    
//keeping this for when we add actual city into the mix
// var avgWeatherTemp;
    // $("#search-city").on("click", function (event) {
    //   event.preventDefault();

    //   var city = $("#city-input").val();
    //   var appKey = "166a433c57516f51dfab1f7edaed8413"
    //   var queryURL = "https://api.openweathermap.org/data/2.5/weather?q=philadelphia,us&appid=" + appKey;

    //   $.ajax({
    //     url: queryURL,
    //     method: "GET"
    //   }).then(function (response) {
    //     var maxWeatherTemp = response.main.temp_max;
    //     var minWeatherTemp = response.main.temp_min;
    //     avgWeatherTemp = (maxWeatherTemp + minWeatherTemp) / 2;
    //     // $("#weather-view").html("<p>" + avgWeatherTemp + "kelvin </p>");
    //     if (avgWeatherTemp > 200) {
    //       var warmWeatherCategories = ["smoothie", "salad", "cold soup"];
    //       var apiID = "9974c215";
    //       var apiKey = "66e631dd94f26b89b80cfb12794ede2c";
    //       var foodURL = "https://api.edamam.com/search?q=" + warmWeatherCategories[0] + "&app_id=" + apiID + "&app_key=" + apiKey;
    //       $.ajax({
    //         url: foodURL,
    //         method: "GET"
    //       }).then(function (data) {
    //         console.log(data);
    //         $("#weather-view").html("<p> Recipe Name: " + data.hits[0].recipe.label + "</p>")
    //       });
    //     };
    //   });
    // });
  </script>
</body>

</html>